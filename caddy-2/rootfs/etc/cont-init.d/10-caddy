#!/usr/bin/with-contenv bashio
# ==============================================================================
# Home Assistant Add-on: Caddy 2
# Check caddy binary
# ==============================================================================

bashio::log.info 'Prepare Caddy...'

# Check for custom Caddy binary path config
if bashio::config.has_value 'custom_binary_path'; then
    bashio::log.debug "Set custom Caddy binary path"
    export CADDY_PATH="$(bashio::config 'custom_binary_path')"
else
    export CADDY_PATH="/share/caddy/caddy"
fi

# Check for custom Caddy binary at Caddy path
if bashio::fs.file_exists "${CADDY_PATH}"; then
    bashio::log.info "Found custom Caddy at ${CADDY_PATH}"
else
    export CADDY_PATH="/usr/bin/caddy"
    bashio::log.info "Use built-in Caddy"
fi

# Check caddy version
"${CADDY_PATH}" version